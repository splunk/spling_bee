<form script="custom_layout_width.js">
  <label>SPLing Bee</label>
  <search>
    <query>| inputlookup splbee_questions.csv | search Category="$category_token$" Number=$question_token$ | fields Number, Question, Answer, Hints</query>
    <earliest>-7d@d</earliest>
    <latest>now</latest>
    <preview>
      <set token="question">$result.Question$</set>
      <set token="hint">$result.Hints$</set>
      <set token="answer">$result.Answer$</set>
    </preview>
  </search>
  <fieldset submitButton="false">
    <input type="time" token="time_token">
      <label>Select Time Range:</label>
      <default>
        <earliest>rt</earliest>
        <latest>rt</latest>
      </default>
    </input>
    <input type="dropdown" token="category_token" searchWhenChanged="true">
      <label>Select A Category</label>
      <search>
        <query>| inputlookup splbee_questions.csv | stats count by Category | sort Category</query>
      </search>
      <fieldForLabel>Category</fieldForLabel>
      <fieldForValue>Category</fieldForValue>
      <default>Setup</default>
      <initialValue>Setup</initialValue>
    </input>
    <input type="dropdown" token="question_token" searchWhenChanged="true">
      <label>Select Question:</label>
      <fieldForLabel>Number</fieldForLabel>
      <fieldForValue>Number</fieldForValue>
      <search>
        <query>| inputlookup splbee_questions.csv | search Category="$category_token$" | stats count by Number</query>
      </search>
      <default>1</default>
      <initialValue>1</initialValue>
    </input>
    <input type="link" token="hint_token" searchWhenChanged="true">
      <label>Show Hint?</label>
      <choice value="setup">Setup</choice>
      <choice value="yes">Yes</choice>
      <choice value="no">No</choice>
      <default>setup</default>
      <initialValue>setup</initialValue>
      <change>
        <condition value="yes">
          <set token="showHint">true</set>
          <unset token="hideHint"></unset>
          <unset token="showSetup"></unset>
        </condition>
        <condition value="no">
          <set token="hideHint">true</set>
          <unset token="showHint"></unset>
          <unset token="showSetup"></unset>
        </condition>
        <condition value="setup">
          <set token="showSetup">true</set>
          <unset token="showHint"></unset>
          <unset token="hideHint"></unset>
        </condition>
      </change>
    </input>
    <input type="link" token="answer_token" searchWhenChanged="true">
      <label>Show Answer</label>
      <choice value="show_answer">Answer</choice>
      <choice value="hide_answer">Hide</choice>
      <default>Hide</default>
      <initialValue>Hide</initialValue>
      <change>
        <condition value="show_answer">
          <set token="showAnswer">true</set>
          <unset token="hideAnswer"></unset>
        </condition>
        <condition value="hide_answer">
          <set token="hideAnswer">true</set>
          <unset token="showAnswer"></unset>
        </condition>
      </change>
    </input>
  </fieldset>
  <row>
    <panel>
      <html depends="$showSetup$">
          <h2>
            1. Use your local splunk instance or sign-up for a cloud trial at https://www.splunk.com/page/sign_up/cloudtrial
             <br/>
            2. Download and install the <strong>"Add-on for SPLing Bee"</strong> App from Splunkbase, restart and open the SPLing Bee app.
        <br/>
            3. Go to Settings --&gt; Advanced Search --&gt; Search Macros and edit the <strong>`sendresults`</strong> macro.  Replace &lt;yournamehere&gt; with a unique name and &lt;ip&gt; with ***PUT MASTER/JUDGE INSTANCE IP ADDRESS HERE***.
        <br/>
            4. Go back to SPLing Bee App and test out question #1. Look for your name on Scoreboard and make sure you see green! Make sure port 8999 is open on your machine/network if your search is stuck at "finalizing".
        <br/>
            5. For Future Questions: Make sure your result is renamed as <strong>"answer"</strong>, use the macro <strong>`sendresults`</strong> to submit your answers!
          </h2>
    </html>
    </panel>
    <panel>
      <html depends="$showHint$">
            <h1>
              <center>
            <strong>Hint:</strong> $hint$</center>
            </h1>
     </html>
    </panel>
  </row>
  <row>
    <panel>
      <html>
            <h1>
              <center>
            Question #$question_token$: <strong>$question$</strong>
          </center>
            </h1>
	    </html>
    </panel>
    <panel>
      <html depends="$showAnswer$">
            <h1>
              <center>
            Answer #$question_token$: <strong>$answer$</strong>
          </center>
            </h1>
	    </html>
    </panel>
  </row>
  <row>
    <panel>
      <single>
        <title>Total Submissions</title>
        <search>
          <query>index=spl_bee | timechart count | streamstats sum(count) as total | eval tmp=$question_token$ | fields _time total</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="colorBy">trend</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xf58f39","0xd93f3c"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="trendInterval">auto</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
      <single>
        <title>Unique Submissions</title>
        <search>
          <query>index=spl_bee | spath | stats latest(results{}.answer) as User_Answer latest(results{}.contestant) as Contestant latest(_time) as LatestSubmissionTime latest(custom.search) as LastestSubmittedSearch latest(runDuration) as Duration by results{}.contestant host | convert ctime(LatestSubmissionTime) | eval Question=$question_token$ | join type=outer question AS Number [|inputlookup splbee_questions.csv | search Number=$question_token$ Category=$category_token$ | fields Answer] | filldown Answer | eval Correct = if(User_Answer=Answer,1,0) | stats count</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0xd93f3c","0x6db7c6"]</option>
        <option name="rangeValues">[0]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="trendInterval">auto</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
      <single>
        <title>Correct Answers</title>
        <search>
          <query>index=spl_bee | spath | stats latest(results{}.answer) as User_Answer latest(results{}.contestant) as Contestant latest(_time) as LatestSubmissionTime latest(custom.search) as LastestSubmittedSearch latest(runDuration) as Duration by results{}.contestant host | convert ctime(LatestSubmissionTime) | eval Question=$question_token$ | join type=outer question AS Number [|inputlookup splbee_questions.csv | search Number=$question_token$ Category=$category_token$ | fields Answer] | filldown Answer | eval Correct = if(User_Answer=Answer,1,0) | stats sum(Correct) as count</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="numberPrecision">0</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
        <option name="rangeColors">["0xd93f3c","0x65a637"]</option>
        <option name="rangeValues">[0]</option>
        <option name="trendInterval">auto</option>
        <option name="unitPosition">after</option>
      </single>
      <chart>
        <search>
          <query>index=spl_bee | spath | stats latest(results{}.answer) as User_Answer latest(results{}.contestant) as Contestant latest(_time) as LatestSubmissionTime latest(custom.search) as LastestSubmittedSearch latest(runDuration) as Duration by results{}.contestant host | convert ctime(LatestSubmissionTime) | eval Question=$question_token$ | join type=outer question AS Number [|inputlookup splbee_questions.csv | search Number=$question_token$ Category=$category_token$ | fields Answer] | filldown Answer | eval breakdown = if(User_Answer=Answer,"Correct","Incorrect") | stats count by breakdown</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel>
      <table>
        <title>Round $question_token$ Submissions</title>
        <search>
          <query>index=spl_bee | spath | stats latest(results{}.answer) as User_Answer latest(results{}.contestant) as Contestant latest(_time) as LatestSubmissionTime latest(custom.search) as LastestSubmittedSearch latest(runDuration) as Duration by results{}.contestant host | convert ctime(LatestSubmissionTime) | eval Question=$question_token$ | join type=outer question AS Number  [|inputlookup splbee_questions.csv | search Number=$question_token$ Category=$category_token$ | fields Answer] | filldown Answer | eval Correct = if(User_Answer=Answer,1,0) | table Question Contestant host LatestSubmissionTime Duration Correct | sort - Correct + LatestSubmissionTime | streamstats count as row | eval Bonus = if(Correct=1,101-row,0) | fields - row | rename Question AS Q</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">true</option>
        <format type="color" field="Bonus">
          <colorPalette type="minMidMax" maxColor="#1E93C6" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Correct">
          <colorPalette type="map">{"0":#ED8440,"1":#65A637}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
</form>